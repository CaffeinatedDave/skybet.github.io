---
layout:     post
title:      "A/B Testing in Javascript with Canvass"
date:       2017-05-14 15:45:00
summary:    A/B testing is a popular method for testing changes. Here's how we do it with the Canvass library.
author:     adam_blanchard
image:      test-tube.png
category:   Software Engineering
tags:       javascript, open-source, experimentation, abtesting
---
A/B testing is a popular method used to identify new changes or features which increase some metric (often the conversion rate in our industry). It works by creating a variant of the website which is served to only a subset of the users. It's performance is then compared to the current version of the website.

There are many services out there which provide a/b testing functionality (for example: [Qubit](http://www.qubit.com/), [Maxymiser](https://www.maxymiser.com/) and [Optimizely](https://www.optimizely.com/)). The easiest way to use most of these services is to include a snippet of javascript at the top of your page. You can then build your variants in their online editor. The service takes care of the rest through the javascript snippet, such as pushing different users to a variant and tracking the performance of each.

We decided to do things a little differently on the Vegas product by building our a/b tests directly in our codebase. This was for a few reasons:

1. We have quite a complex javascript front-end. Our older codebase uses [React](https://facebook.github.io/react/) and [Fluxible](http://fluxible.io/), and our newer one uses [React](https://facebook.github.io/react/), [Typescript](https://www.typescriptlang.org/) and [Alt](http://alt.js.org/). Building variants in another service caused us issues when we were modifying the DOM outside of our application. We often spent more time fiddling around with hacks to make them work with our application rather than building the test itself.

2. We have great engineering standards and a good delivery pipeline which we didn't want to bypass when building tests through a third party service. Instead, we wanted to use good coding standards, build trustworthy and well tested features and a use smooth release process in a/b testing, too.

However, building a whole a/b testing service from scratch would take a lot of work. There are some really good service providers out there so we wanted to take advantage of the platforms that they offer, but still keep the benefits described above. To achieve this, we created Canvass.

Canvass provides a framework for us to write a/b tests in our React application, while integrating with the Qubit platform. Using Canvass, you define an experiment by it's variants and when it should be displayed to a user. It provides an interface to the provider of your choosing (in our case, Qubit), where we can use them for the good stuff: Traffic allocation and data tracking.

Canvass helps your experiments and codebase stay simple, decoupled and easy to manage. It is event based, which gives you a lot of flexibility when implementing a test. You simply listen to events fired from Canvass, and react to them accordingly. The easiest way to demonstrate is by example:

```javascript
import canvass from 'canvass';
import Experiment from 'canvass/distribution/Experiment';

...
let myExperiment = new Experiment('MyExperiment', triggers, variants);

canvass.addExperiment(myExperiment);
```

This is how you register a new experiment in your application. Then, in your view layer, you would simply listen to the ACTIVE event and render the view accordingly:

```javascript
canvass.on('MyExperiment.ACTIVE', () => {
    const display = canvass.getExperiment('MyExperiment').getVariant());
    // Render display object here
});
```

You can find out more about Canvass and how to use it at the [Canvass Github repo](https://github.com/skybet/canvass).
